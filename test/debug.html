<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>mdeditor test</title>
<style type="text/css">
    html,
    body {
        margin: 0px;
        height: 100%;
        width: 100%;
        font-family: 微软雅黑;
    }

    .container {
        width: 90%;
        height: 100%;
        margin: auto;
        /* margin-top: 10px; */
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css">
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/an-old-hope.min.css"> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_4227162_qxxgkq5rzd.css">
<link rel="stylesheet" href="./../index.css">
<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.8.0/highlight.min.js"></script>
<script src="https://microget-1300406971.cos.ap-shanghai.myqcloud.com/glicon/lib/mermaid.min.js"></script>
<script
    src="https://microget-1300406971.cos.ap-shanghai.myqcloud.com/glicon/lib/shiki/dist/index.unpkg.iife.js"></script>
<script type="text/javascript" src="./../dist/mdpress-editor.js"></script>
<script>
    var require = { paths: { vs: './lib/monaco-editor/min/vs' } };
</script>
<script src="./lib/monaco-editor/min/vs/loader.js"></script>
<script src="./lib/monaco-editor/min/vs/editor/editor.main.nls.js"></script>
<script src="./lib/monaco-editor/min/vs/editor/editor.main.js"></script>

<body>

    <div id="map" class="container"></div>

    <script>

        function loadMonaco() {
            require(['vs/editor/editor.main'], function () {
                // console.log(monaco);
                // var editor = monaco.editor.create(document.getElementById('container'), {
                //     value: ['function x() {', '\tconsole.log("Hello world!");', '}'].join('\n'),
                //     language: 'javascript'
                // });
                mdpress.registerMonaco(monaco);
                loadShiki();
            });
        }

        function loadShiki() {
            const languages = [
                'objective-c',
                'bat',
                'c',
                'cpp',
                'csharp',
                'css',
                'dart',
                'docker',
                'git-commit',
                'glsl',
                'go',
                'html',
                'http',
                'ini',
                'java',
                'json',
                'jsx',
                'kotlin',
                'latex',
                'julia',
                'less',
                'markdown',
                'mermaid',
                'nginx',
                'php',
                'plsql',
                'postcss',
                'powershell',
                'python',
                'rust',
                'sass',
                'scala',
                'scss',
                'shellscript',
                'sql',
                'svelte',
                'swift',
                'toml',
                'typescript',
                'viml',
                'vue-html',
                'vue',
                // 'wasm',
                'yaml',
                'xml',

            ];
            shiki
                .getHighlighter({
                    theme: 'material-theme-palenight',
                    langs: languages
                })
                .then(highlighter => {
                    mdpress.registerShikiHighlighter(highlighter);
                    // const html = highlighter.codeToHtml(code, { lang: 'js' })
                    // document.getElementById('map').innerHTML = html
                    createEditor();
                })

        }
        let mEditor;
        function createEditor() {
            mEditor = new mdpress.MDEditor('#map', {
                // monaco: window.monaco,
                monacoOptions: {
                    // language: 'markdown-math'
                    // theme: 'vs-dark'
                }
            })
            loadData();
        }

        function loadData() {
            fetch('./data.md').then(res => res.text()).then(text => {
                mEditor.setValue(text);
            })
        }

        loadMonaco();
    </script>
</body>

</html>